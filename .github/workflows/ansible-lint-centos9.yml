name: 🐧 Ansible-Lint in CentOS Stream 9

on:
  workflow_dispatch:
  pull_request:
    branches: [ main, develop ]

jobs:
  ansible-lint-centos9:
    name: 🐧 Ansible-Lint (CentOS Stream 9)
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@v5

      - name: 🐳 Run ansible-lint tests in CentOS Stream 9 container
        run: |
          docker pull quay.io/centos/centos:stream9
          docker run --rm -v "${{ github.workspace }}:/workspace" -w /workspace \
            quay.io/centos/centos:stream9 bash -c '
              dnf install -y python3 python3-pip git && \
              pip3 install ansible ansible-lint && \
              
              # Install aider-lint-fixer with graceful dependency resolution
              echo "🔍 Installing aider-lint-fixer with flexible aider-chat version..."
              pip3 install -e . || {
                echo "⚠️ Standard install failed, trying with latest available aider-chat..."
                pip3 install aider-chat==0.82.3 && pip3 install -e . --no-deps --force-reinstall
              } && \
              
              pip3 install pytest && \
              echo "✅ Installation successful, running tests..." && \
              pytest tests/test_ansible_lint_integration.py --maxfail=3 --disable-warnings -v
            '
